name: Deploy Frontend 

on:          # Trigger the workflow on push to the main branch ( declancheur de workflow)
    push:
        branches:
            [main,master,dev]
          
jobs:
    Test_Unitaire:
        runs-on: ubuntu-latest
        steps:
            - name: clone code 
              uses: actions/checkout@v5
            - name: install dependencies
              run: npm i
            - name: run commande jest
              run: npm run test 


    Build_and_push:
        runs-on: ubuntu-latest
        needs: Test_Unitaire
        steps:
            - name: clone code 
              uses: actions/checkout@v5
            - name: build docker image
              run: docker build -t  adeem07/app-session14 --build-arg VITE_API_URL=https://api.33.lebondeveloppeur.net .  
            - name : tag image #rename image 
              run: docker tag adeem07/app-session14 adeem07/app-session14:${{ github.run_number }}
            - name: Login to Docker Hub
              uses: docker/login-action@v3
              with:
               username: ${{ vars.DOCKERHUB_USERNAME }}
               password: ${{ secrets.DOCKERHUB_TOKEN_FRONTEND }}
            - name : list image 
              run : docker images 

            - name : docker push 
              run : docker push adeem07/app-session14:${{ github.run_number }}   

               